# DevOps 和部署 Prompts

## 容器化

### Docker 配置

```text
请为 [应用类型] 编写 Dockerfile：

要求：
1. 使用合适的官方基础镜像
2. 遵循最佳实践（多阶段构建、安全考虑等）
3. 设置必要的环境变量
4. 正确暴露端口
5. 定义启动命令
6. 遵循 Git 开发流程规范：
    - 所有新功能开发必须在新建的功能分支上进行
    - 开发完成后必须进行代码审查（CR）
    - 审核通过后才能将功能分支合并到主分支
    - 禁止直接在主分支上进行开发
    - 项目采用版本管理，只有在CR通过并合并到主分支时才会触发版本变更、打标签和同步远程仓库
```

### Docker Compose 编排

```text
请用 Docker Compose 编排 [应用架构，如"前端+后端+数据库"]：

服务包括：
1. [服务1，如前端应用]
2. [服务2，如后端API]
3. [服务3，如数据库]

要求：
1. 各服务间的网络配置
2. 数据持久化处理
3. 环境变量管理
4. 健康检查配置
```

### Docker Compose 调试场景

```text
请为 [应用架构，如"前端+后端+数据库"] 项目提供 Docker Compose 调试和故障排除方案：

常见调试场景：
1. 服务启动失败
   - 容器退出码分析
   - 依赖服务启动顺序问题
   - 端口冲突检查

2. 服务间通信问题
   - 网络连接性测试
   - DNS 解析检查
   - 防火墙和安全组配置

3. 数据库连接问题
   - 数据库初始化状态检查
   - 连接串和凭据验证
   - 数据库权限配置

4. 性能问题
   - 资源使用情况监控
   - 容器资源限制调整
   - 网络延迟分析

5. 日志和监控
   - 容器日志收集策略
   - 健康检查配置优化
   - 监控指标设置

调试工具和命令：
- docker-compose logs [服务名]
- docker-compose exec [服务名] [命令]
- docker-compose ps
- docker-compose top
- docker inspect [容器名]
- docker network ls
- docker volume ls

环境差异化配置：
1. 开发环境配置（docker-compose.dev.yml）
2. 测试环境配置（docker-compose.test.yml）  
3. 生产环境配置（docker-compose.prod.yml）
4. 调试环境配置（docker-compose.debug.yml）

故障排除流程：
1. 检查服务状态和日志
2. 验证网络连接性
3. 检查环境变量和配置
4. 验证数据卷挂载
5. 检查资源使用情况
6. 重启相关服务
```

## CI/CD 流水线

### GitHub Actions

```text
请为 [项目类型] 编写 GitHub Actions 工作流：

工作流应包括：
1. 代码检查（Linting）
2. 运行测试
3. 构建 Docker 镜像
4. 推送镜像到 [镜像仓库，如 Docker Hub/GitHub Packages]
5. 部署到 [环境，如测试环境/生产环境]
```

### GitLab CI/CD

```text
请为 [项目类型] 编写 GitLab CI/CD 配置：

流水线阶段：
1. 安装依赖
2. 代码质量检查
3. 运行测试（单元测试、集成测试）
4. 构建和推送镜像
5. 部署到 [环境]
```

### 部署策略对比与选择

```text
应用类型： [无状态 / 有状态 / 长连接]
目标： [零停机 / 成本优化 / 快速回滚]

请：
1. 对比策略：滚动更新 / 蓝绿 / 金丝雀 / A/B / Shadow
2. 每种策略优缺点与适用场景
3. 推荐方案与实施步骤
4. 回滚与监控集成要点
```

## 基础设施即代码

### Terraform 配置

```text
请用 Terraform 为 [云服务商，如 AWS/Azure/GCP] 编写基础设施配置：

资源包括：
1. [计算资源，如虚拟机/容器服务]
2. [网络资源，如 VPC、负载均衡器]
3. [存储资源，如对象存储、数据库]
4. [安全资源，如安全组、IAM 角色]

要求：
1. 模块化设计
2. 环境差异化配置
3. 安全最佳实践
4. 成本优化考虑
```

### Kubernetes 配置

```text
请为 [应用类型] 编写 Kubernetes 部署配置：

资源包括：
1. Deployment 配置
2. Service 配置
3. Ingress 配置（如需要）
4. ConfigMap 和 Secret 配置
5. PersistentVolume 配置（如需要）

要求：
1. 健康检查探针
2. 资源限制和请求
3. 滚动更新策略
4. 配置和密钥管理
```

### K8s 资源分配与容量规划

```text
当前集群：节点= [数量]，规格= [vCPU/内存]
工作负载： [Deployment 列表]

请：
1. 计算当前资源利用率与碎片率
2. 推荐 Requests/Limits 调整策略
3. 节点扩缩容阈值与 HPA/VPA 建议
4. 未来 [周期] 增长预测与采购建议
```

## 监控和日志

### Prometheus 监控

```text
请为 [应用类型] 配置 Prometheus 监控：

要求：
1. 应用指标暴露（如使用 [客户端库]）
2. Prometheus 抓取配置
3. 常用指标收集（如请求延迟、错误率等）
4. 告警规则定义
```

### ELK 日志系统

```text
请搭建 ELK（Elasticsearch, Logstash, Kibana）日志收集系统：

要求：
1. 应用日志收集配置
2. Logstash 解析规则
3. Elasticsearch 索引策略
4. Kibana 可视化配置
```

### 可观测性体系设计

```text
范围：日志 / 指标 / Trace / Profiling
技术栈： [Prometheus / Loki / Jaeger / OpenTelemetry]

请：
1. 指标分层：基础Infra / 服务 / 业务 / SLO
2. 指标命名与标签规范
3. 采样与存储生命周期策略
4. 告警分类：可用性 / 性能 / 安全 / 成本
```

## 安全加固

### 安全扫描

```text
请为 [项目类型] 配置安全扫描流程：

包括：
1. 依赖安全扫描（如 Snyk、Dependabot）
2. 容器镜像安全扫描
3. 代码安全扫描（如 SonarQube）
4. 基础设施安全检查
```

### 零信任网络

```text
请为 [系统架构] 设计零信任安全模型：

要求：
1. 身份验证和授权机制
2. 网络分段和微隔离
3. 服务间通信加密
4. 持续验证和监控
```

### 供应链安全与 SBOM

```text
技术栈： [语言 / 包管理器]

请：
1. SBOM 生成工具推荐与示例（CycloneDX / SPDX）
2. 依赖来源与签名验证策略
3. 构建产物签名与验证流程（cosign）
4. 供应链攻击监控与响应建议
```

## 成本与效率

### 云资源成本优化

```text
当前账单范围： [月度 / 季度]
主要服务： [列表]

请：
1. 按服务列出前三成本项及浪费点
2. 预留实例 / Savings Plan / Spot 策略
3. 资源标签与成本归集方案
4. 优化行动清单（影响 vs 工作量）
```

### CI/CD 流水线耗时优化

```text
当前平均耗时： [数值]
主要阶段： [Install/Test/Build/Deploy]

请：
1. 阻塞点分析
2. 缓存策略（依赖/构建层/容器层）
3. 并行与矩阵优化建议
4. 快速失败与跳过策略设计
```

## 灾难恢复和备份

### 备份策略

```text
请为 [系统架构] 设计备份策略：

要求：
1. 数据备份频率和保留策略
2. 备份存储位置和加密
3. 备份验证和恢复测试
4. 在 [部署环境] 中的实现方案
```

### 灾难恢复

```text
请为 [系统架构] 设计灾难恢复方案：

要求：
1. 故障检测和自动切换
2. 数据同步和一致性保证
3. 在 [部署环境] 中的实现方案
4. 恢复时间目标（RTO）和恢复点目标（RPO）
```

### BCP (业务连续性) 评估

```text
关键系统： [列表]
当前 RTO/RPO： [值]

请：
1. 识别单点风险与薄弱环节
2. 多活 / 冷备 / 异地容灾策略对比
3. 业务分级与恢复优先级排序
4. 年度演练计划建议
```

## 可靠性与混沌工程

### 混沌实验设计

```text
目标： [验证降级 / 容错 / 自动恢复]
范围： [服务 / 组件]

请：
1. 故障注入类型（延迟/丢包/熔断/进程故障）
2. 实验前置安全校验清单
3. 验证指标与成功判定条件
4. 回滚与自动恢复策略
```

### SLO / Error Budget 制定

```text
服务： [名称]
目标用户体验： [描述]

请：
1. 定义核心指标（请求成功率/延迟/P99 等）
2. 计算 SLI 数据采集方式
3. 设定 SLO 目标与 Error Budget
4. 超预算时的防御与发布控制策略
```

## 平台工程与内部开发者平台 (IDP)

### 自助式交付平台能力规划

```text
团队规模： [人数]
当前痛点： [手工操作 / 重复配置 / 环境不一致]

请：
1. 能力分层（环境/编排/交付/观测/安全）
2. 首批 MVP 功能列表
3. 自助接口与权限模型设计
4. 成效衡量指标（交付 Lead Time / 变更失败率）
```

### 基础模板与脚手架规范

```text
技术栈： [Node / Java / Go / Python]

请：
1. 项目模板目录结构
2. 必备内建能力（日志/配置/健康检查/安全扫描）
3. 初始化参数与变量说明
4. 版本升级与向后兼容策略
```

## 环境与配置管理

### 多环境配置治理

```text
环境： Dev / Test / Staging / Prod

请：
1. 配置分类（静态/动态/敏感）
2. 存储与分发方案（GitOps / ConfigMap / Secret 管理）
3. 变更流程与审核机制
4. Drift 检测与回滚策略
```

### Feature Flag 体系

```text
使用场景： [灰度 / A/B / 限制功能]

请：
1. Flag 分类（发布 / 实验 / 权限 / 配额）
2. 生命周期管理策略
3. SDK 设计要点（缓存/降级/打点）
4. 清理与治理机制
```

## 示例请求模板

```text
当我描述：
背景：<系统/目标>
问题或目标：<性能 / 成本 / 安全 / 稳定>
约束：<预算 / 工期 / 合规>
输出：请按（现状诊断 -> 方案选型对比 -> 推荐实施步骤 -> 风险与缓解 -> 验收指标）结构生成
```