# 需求实现规范化 Prompts

## 需求分析与准备

### 需求理解和确认
```
我需要实现以下需求：[需求描述]

请帮我：
1. 分析需求的核心目标
2. 识别必要的改动点
3. 评估对现有功能的影响
4. 列出潜在的风险点
5. 确认实现范围边界

输出格式：
- 需求核心：[一句话描述]
- 影响范围：[具体文件和功能]
- 风险评估：[可能的副作用]
- 实现方案：[简要技术方案]
```

### 创建功能分支
```
请为需求 "[需求名称]" 创建新的功能分支：

分支命名规范：
- feature/[功能简述]：新功能开发
- fix/[问题简述]：修复问题
- refactor/[重构内容]：代码重构
- perf/[优化内容]：性能优化

执行步骤：
1. 确保主分支是最新的
2. 从主分支创建新分支
3. 设置清晰的分支描述

命令示例：
git checkout main
git pull origin main
git checkout -b feature/add-user-authentication
```

## 最小化改动原则

### 代码修改规范
```
实现需求时请遵循最小化改动原则：

核心原则：
1. 只修改必要的代码
   - 不重构无关代码
   - 不优化无关逻辑
   - 不修改代码风格

2. 保持向后兼容
   - 不改变现有接口
   - 不删除公共方法
   - 不修改数据结构

3. 局部化影响
   - 使用功能开关
   - 渐进式迁移
   - 保留回退方案

4. 数据安全
   - 不删除历史数据
   - 保留数据备份
   - 提供数据迁移脚本
```

### 精准定位修改点
```
帮我定位需求 "[需求描述]" 的精确修改点：

分析步骤：
1. 代码搜索
   - 搜索相关关键词
   - 查找调用链路
   - 识别依赖关系

2. 影响分析
   - 列出需要修改的文件
   - 标记只读文件（仅供参考）
   - 评估修改优先级

3. 最小化方案
   - 优先使用配置
   - 其次扩展现有功能
   - 最后才新增代码

输出清单：
- 必须修改：[文件列表和原因]
- 可能影响：[相关文件]
- 保持不变：[不应修改的文件]
```

## 数据处理优化

### 数据缩减策略
```
处理大量数据时的优化策略：

1. 数据查询优化
   - 添加必要索引
   - 使用分页查询
   - 限制返回字段
   - 增加查询条件

2. 数据传输优化
   - 压缩传输数据
   - 使用流式处理
   - 实现增量更新
   - 启用缓存机制

3. 数据存储优化
   - 清理冗余数据
   - 归档历史数据
   - 使用数据分区
   - 优化数据结构

示例代码框架：
// 分页查询
const pageSize = 100
const offset = (page - 1) * pageSize

// 字段过滤
const fields = ['id', 'name', 'status']

// 条件过滤
const where = { status: 'active', created_at: { $gte: lastWeek } }
```

### 性能影响评估
```
评估需求实现对性能的影响：

检查项：
1. 查询性能
   - 执行计划分析
   - 查询时间对比
   - 索引使用情况

2. 内存使用
   - 内存占用监控
   - 对象创建频率
   - 垃圾回收压力

3. 网络开销
   - 请求响应时间
   - 数据传输量
   - 并发处理能力

4. 存储影响
   - 磁盘空间占用
   - I/O 操作频率
   - 备份恢复时间
```

## 安全的实现流程

### 变更前置检查
```
在开始实现前进行全面检查：

检查清单：
□ 确认在正确的分支上工作
□ 本地代码已同步最新版本
□ 运行测试确保基线正常
□ 备份重要数据和配置
□ 了解回滚方案
□ 确认不影响生产环境
□ 相关人员已经知晓
```

### 增量式实现
```
采用增量方式逐步实现需求：

实施步骤：
1. 第一阶段：基础框架
   - 创建必要的文件结构
   - 定义接口和数据模型
   - 编写单元测试用例

2. 第二阶段：核心功能
   - 实现主要业务逻辑
   - 添加必要的验证
   - 保证基本功能可用

3. 第三阶段：完善优化
   - 处理边界情况
   - 优化性能瓶颈
   - 完善错误处理

4. 第四阶段：集成测试
   - 端到端测试
   - 回归测试
   - 性能测试
```

### 代码审查要点
```
提交代码审查时的自查清单：

代码质量：
□ 只包含必要的修改
□ 没有修改无关文件
□ 保持原有代码风格
□ 没有引入新的依赖
□ 注释清晰准确

功能完整性：
□ 满足所有需求点
□ 处理异常情况
□ 考虑边界条件
□ 向后兼容性

测试覆盖：
□ 新增代码有测试
□ 现有测试通过
□ 测试覆盖率合格
□ 包含集成测试

文档更新：
□ API 文档更新
□ 配置说明完整
□ 变更日志记录
□ 部署说明更新
```

## 风险控制

### 灰度发布策略
```
实现功能开关进行灰度发布：

实现方式：
1. 配置开关
   - 环境变量控制
   - 配置文件开关
   - 数据库配置
   - 远程配置中心

2. 用户分组
   - 按百分比划分
   - 按用户特征
   - 按地域划分
   - 白名单机制

3. 监控指标
   - 功能使用率
   - 错误率变化
   - 性能指标
   - 用户反馈

示例代码：
const featureFlag = {
  isEnabled: (userId) => {
    // 配置开关
    if (!config.features.newFeature.enabled) return false
    
    // 白名单
    if (config.features.newFeature.whitelist.includes(userId)) return true
    
    // 百分比控制
    const percentage = config.features.newFeature.percentage
    return (userId % 100) < percentage
  }
}
```

### 回滚方案
```
制定完整的回滚方案：

回滚准备：
1. 代码回滚
   - Git 标记回滚点
   - 保存配置快照
   - 准备回滚脚本

2. 数据回滚
   - 数据备份策略
   - 迁移脚本可逆
   - 保留原始数据

3. 快速切换
   - 功能开关关闭
   - 负载均衡切换
   - DNS 切换方案

回滚流程：
1. 发现问题后立即评估影响
2. 通知相关人员
3. 执行回滚操作
4. 验证回滚结果
5. 分析问题原因
6. 制定修复方案
```

## 最佳实践建议

### 需求实现检查清单
```
完整的需求实现检查清单：

需求阶段：
□ 需求理解准确
□ 影响范围明确
□ 技术方案合理
□ 风险评估完整

开发阶段：
□ 分支创建正确
□ 最小化改动
□ 代码质量合格
□ 测试用例完整

测试阶段：
□ 单元测试通过
□ 集成测试通过
□ 性能测试达标
□ 安全检查通过

发布阶段：
□ 代码审查通过
□ 文档更新完整
□ 部署方案就绪
□ 回滚方案可用

监控阶段：
□ 监控指标正常
□ 错误日志检查
□ 性能指标稳定
□ 用户反馈良好
```

### 常见错误避免
```
需求实现中的常见错误和预防措施：

1. 过度设计
   ❌ 错误：实现需求时顺带重构整个模块
   ✅ 正确：只实现需求功能，记录重构建议

2. 忽视兼容性
   ❌ 错误：直接修改接口参数或返回值
   ✅ 正确：新增接口或版本化处理

3. 数据处理不当
   ❌ 错误：直接删除或修改历史数据
   ✅ 正确：保留原数据，新增字段标记

4. 缺少防护措施
   ❌ 错误：直接上线新功能
   ✅ 正确：使用功能开关和灰度发布

5. 测试不充分
   ❌ 错误：只测试正常流程
   ✅ 正确：覆盖异常和边界情况
```