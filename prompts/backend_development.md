# 后端开发 Prompts

## API 开发

### RESTful API 实现
```
请用 [后端语言/框架，如 Node.js/Express、Python/Django、Go/Gin] 实现以下 RESTful API：

API 功能：[具体功能描述，如"用户管理"、"订单处理"等]

要求：
1. 完整的 CRUD 操作
2. 请求验证和错误处理
3. 数据库集成（[数据库类型，如 PostgreSQL、MongoDB]）
4. 身份验证和授权机制
5. API 文档（如 Swagger/OpenAPI）
6. 日志记录
7. 遵循 Git 开发流程规范：
   - 所有新功能开发必须在新建的功能分支上进行
   - 开发完成后必须进行代码审查（CR）
   - 审核通过后才能将功能分支合并到主分支
   - 禁止直接在主分支上进行开发
   - 项目采用版本管理，只有在CR通过并合并到主分支时才会触发版本变更、打标签和同步远程仓库
```

### GraphQL API 实现
```
请用 [后端语言/框架] 实现 GraphQL API：

功能需求：
1. 定义类型和关系
2. 实现查询和变更操作
3. 数据加载优化（如 DataLoader）
4. 错误处理
5. 分页支持
6. 在 [前端框架] 中的使用示例
```

## 数据库设计与操作

### ORM 使用
```
请用 [ORM 框架，如 Sequelize/TypeORM/Prisma] 实现 [业务场景] 的数据模型。

要求：
1. 定义数据模型和关系
2. 实现基本的 CRUD 操作
3. 复杂查询示例
4. 事务处理（如适用）
```

### 数据库迁移
```
请为 [数据库类型] 编写数据库迁移脚本，实现 [业务变更描述]。

要求：
1. 向上和向下迁移支持
2. 数据迁移处理（如适用）
3. 索引和约束定义
4. 回滚策略
```

## 身份验证与授权

### 认证系统
```
请实现一个完整的身份验证系统：

功能要求：
1. 用户注册和登录
2. 密码加密存储
3. JWT Token 生成和验证
4. 刷新令牌机制
5. 多设备登录支持
6. 使用 [后端语言/框架] 实现
```

### 权限控制
```
请实现基于 [权限模型，如 RBAC/ABAC] 的权限控制系统：

要求：
1. 用户、角色、权限模型设计
2. 中间件/装饰器实现权限检查
3. 细粒度权限控制
4. 在 [后端框架] 中的集成示例
```

## 微服务与分布式系统

### 服务间通信
```
请实现 [微服务架构] 中服务间通信机制：

技术要求：
1. 使用 [通信方式，如 HTTP/gRPC/消息队列]
2. 服务发现机制
3. 负载均衡
4. 容错处理（熔断、重试等）
5. 在 [后端语言/框架] 中的实现
```

### 缓存策略
```
请为 [具体业务场景] 设计并实现缓存策略：

要求：
1. 选择合适的缓存方案（如 Redis/Memcached）
2. 缓存更新策略
3. 缓存穿透、击穿、雪崩的防护
4. 在 [后端语言/框架] 中的实现
```

## 性能与监控

### 性能优化
```
请为 [后端服务] 提供性能优化方案：

优化方向：
1. 数据库查询优化
2. API 响应时间优化
3. 内存使用优化
4. 并发处理优化
```

### 监控和日志
```
请为 [后端服务] 实现监控和日志系统：

要求：
1. 关键指标监控（如响应时间、错误率）
2. 日志收集和分析（如 ELK 栈）
3. 告警机制
4. 分布式追踪（如 Jaeger）
5. 在 [后端语言/框架] 中的实现
```

### 安全加固
```
请为 [后端服务] 提供安全加固方案：

要求：
1. 输入验证和清理
2. 身份验证和授权强化
3. 安全头设置（如 CSP、HSTS）
4. 防止常见攻击（如 CSRF、XSS、SQL 注入）
```

## 测试与质量保障

### 单元与集成测试设计

```text
请为 [模块/服务名称] 设计测试方案：

要求：
1. 列出核心功能点与对应测试用例
2. 区分：单元测试 / 集成测试 / 端到端测试
3. 给出 Mock 策略（数据库/外部 API/消息队列）
4. 边界与异常场景覆盖
5. 使用 [测试框架，如 Jest, pytest, Go test] 示例代码
```

### 回归与覆盖率提升

```text
当前覆盖率：[覆盖率数据]
模块重点：[模块列表]

请：
1. 识别未覆盖的高风险代码路径
2. 列出需新增的测试用例描述
3. 给出优先级与实施顺序
4. 输出提升到 [目标覆盖率]% 的执行计划
```

## API 可靠性与治理

### API 版本管理

```text
现有 API：[/v1/..., /v1/...]
变更需求：[描述]

请输出：
1. 版本策略（URI 前缀 / Header / 媒体类型）
2. 兼容处理（弃用 Deprecation 流程与时间表）
3. 对客户端的迁移建议
4. 版本切换灰度方案
```

### 请求限流与熔断

```text
服务： [服务名称]
峰值 QPS： [数值]
目标：防止突发流量压垮核心依赖

请：
1. 推荐限流算法（令牌桶/漏桶/固定窗口/滑动窗口）
2. 给出伪代码或 [语言] 实现示例
3. 熔断策略（开启条件/半开探测/恢复条件）
4. 与监控指标对接建议
```

### 幂等性设计

```text
业务操作： [如 创建订单 / 支付回调]
风险：重复提交/重复回调

请：
1. 幂等 Key 设计（请求体 Hash / 客户端提交 ID / 业务唯一字段）
2. 幂等记录存储方案（DB/Redis）
3. 状态机简图
4. 失败重试与过期清理策略
5. 示例代码（[语言]）
```

## 消息与异步处理

### 消息队列消费模式

```text
使用 MQ： [Kafka / RabbitMQ / RocketMQ]
场景： [业务描述]

请：
1. 选择消费模式（广播/竞争/顺序）
2. 重试与死信队列策略
3. 去重与幂等处理
4. 消费监控与滞留报警
5. 消费者代码结构示例
```

### 延迟与定时任务

```text
任务类型： [延迟/周期性]
工具： [Quartz / Cron / Redis 延迟队列 / Kafka 延迟主题]

请：
1. 任务可靠执行保障措施
2. 重复调度防护
3. 失败补偿机制
4. 可观测性（日志 + 指标）
```

## 数据一致性与变更

### 分布式事务策略

```text
跨服务操作： [服务A + 服务B + ...]
一致性等级： [最终一致 / 强一致]

请：
1. 比较方案：2PC / TCC / 事务消息 / 本地消息表 / Outbox Pattern
2. 推荐选择及理由
3. 时序/状态流转
4. 失败补偿策略
5. 示例流程图（文本形式）
```

### 数据迁移与回滚

```text
变更： [表/字段/索引]
风险： [描述]

请：
1. 生成迁移脚本（Up/Down）
2. 大表在线迁移策略（分批/影子表/双写）
3. 回滚预案
4. 验证与校验步骤
```

### 数据归档与冷热分层

```text
表： [表名]
规模： [行数 / 增长速率]

请：
1. 分层标准（时间/状态/访问频率）
2. 归档策略（分区/拆表/搬迁存储）
3. 查询透明访问方案
4. 成本与性能评估
```

## 可观测性与故障演练

### 统一错误与日志规范

```text
请为 [服务名称] 制定错误与日志规范：
1. 错误码体系（层级/分类）
2. 日志级别使用准则
3. 结构化日志字段建议（traceId, spanId, userId 等）
4. 敏感信息脱敏策略
5. 示例日志 JSON
```

### 分布式追踪集成

```text
技术栈： [语言/框架]
Tracer： [OpenTelemetry / Jaeger]

请：
1. 埋点范围（入口/外部调用/消息处理）
2. 采样策略
3. 日志-指标-Trace 关联方式
4. 性能开销控制建议
```

### 混沌工程 / 故障注入

```text
目标：验证 [系统/模块] 的韧性

请：
1. 设计注入场景（延迟/超时/异常/部分失败）
2. 安全防护与开关控制
3. 验证指标（错误率 / 延迟 / 降级命中率）
4. 恢复及回收策略
```

## 安全与合规

### 输入与输出校验策略

```text
接口： [接口列表示例]

请：
1. 参数校验层次（Controller / Service / 数据层）
2. 推荐库或方案
3. 错误返回标准结构
4. 安全过滤（XSS/SQL/命令注入）
```

### 审计与合规日志

```text
场景： [如 财务审批 / 权限变更]

请：
1. 审计事件列表
2. 字段 schema（操作者/时间/IP/原值/新值）
3. 存储与检索方案
4. 合规保留与脱敏策略
```

## 配置与灰度

### 功能开关与灰度发布

```text
新功能： [描述]
用户群： [范围]

请：
1. 开关粒度（全局/用户/租户/百分比）
2. 配置来源（本地/远程配置中心）
3. 回滚策略
4. 监控指标需求
```

### 多租户架构策略

```text
模式： [库级隔离 / Schema 隔离 / 逻辑隔离]
租户规模： [数值]

请：
1. 推荐模式及理由
2. 数据访问隔离方案
3. 租户限流与配额
4. 迁移与扩容策略
```

## 性能专项

### 压测方案设计

```text
目标接口： [列表]
指标目标： [P95 / QPS / 错误率]

请：
1. 场景模型（并发/阶梯/突刺）
2. 数据准备与参数化
3. 工具选择（JMeter/k6/Locust）
4. 结果分析与优化优先级
```

### 内存与 GC 优化

```text
语言： [如 Java / Go]
症状： [Full GC 频繁 / 内存上涨]

请：
1. 可能根因假设列表
2. 排查步骤（工具与命令）
3. 优化建议（参数 / 代码模式）
4. 监控指标清单
```

## 国际化与本地化

### i18n 支持改造

```text
当前状态： [硬编码 / 部分支持]
目标语言： [语言列表]

请：
1. 资源抽取策略
2. 语言包加载与缓存
3. 数字/日期/货币格式化
4. 回退与缺失键处理
```

## 示例请求模板扩展

```text
当我描述：
业务背景：<一句话>
目标：<性能 / 安全 / 可靠性>
约束：<技术栈 / 数据量 / 时限>
输出：请按（方案概述 -> 详细步骤 -> 风险与缓解 -> 验收标准）格式生成
```